# 实验5 图书管理系统数据库设计与界面设计
|    学号    |       班级       |      姓名     |    照片    | 
|:-------:|:------------- | ----------:|----------:|
|   201510414314  |     2015级3班    |   孙守利   |  ![](./psb.jpg '孙守利') |
## 一、全部数据表设计如下

##### 数据表1：馆藏资源-resources
|    项目   |       字段名       |      类型与宽度     |   是否主键    |   是否允许空值  |  说明 | 
|:-------|:------------- | :----------|:----------|:---------|:-----|
|   资源ID  |     resourceID    |   varchar(13)   |  是      |   否     | 系统管理员分配 |
|   资源名称  |     resourceName    |   varchar(30)   |  否      |   否     |    |
|   国际出版号  |     publishingID    |   varchar(14)   |  否      |   否     |  |
|   价格  |     resourcePrice    |   float   |  否      |   否     |    |
|   简介  |     resourceIntroduction    |   varchar(100)   |  否      |   否     |  超过部分不保存 |
|   馆藏数量  |     resourceNumber    |   short   |  否      |   否     |    |
|   可借数量  |     resourceHaveNumber   |   short   |  否      |   否     | 可借数量不可大于馆藏数量 |

##### 数据表2：资源项-resourcesItem
|    项目   |       字段名       |      类型与宽度     |   是否主键    |   是否允许空值  |  说明 | 
|:-------|:------------- | :----------|:----------|:---------|:-----|
|   馆藏流水号  |     resourceFlowNumber    |   varchar(20)   |  是      |   否     | 由入馆时间14位加当日流水5位组成，如果当日流水超过5位，则当日不可入馆 |
|   状态  |     resourceStatus    |   short   |  否      |   否     |  0：表示正常；1：借空；2：超期；3：丢失；4：被盗；5：损坏:6：其他  |

##### 数据表3：图书书目-books
|    项目   |       字段名       |      类型与宽度     |   是否主键    |   是否允许空值  |  说明 | 
|:-------|:------------- | :----------|:----------|:---------|:-----|
|   图书编号  |     bookNo    |   varchar(14)   |  是      |   否     | 1-4位：表示藏室号；  5-6位：表示图书类型；7-10位：表示书架号；11-13位表示图书在书架位置；14位为预留位 |
|   作者  |     bookAuthor    |   varchar(30)   |  否      |   否     |  考虑到有些外国作者名字较长，所以预留长度为30  |
|   ISBN编号  |     bookISBNNo    |   varchar(14)   |  否      |   否     |  继承自国际出版号  |
|   出版社  |     bookPublishHouse    |   varchar(20)   |  否      |   否     |    |
|   出版日期  |     bookPublishDate    |   date   |  否      |   否     |    |

##### 数据表4：预订记录-reservations
|    项目   |       字段名       |      类型与宽度     |   是否主键    |   是否允许空值  |  说明 | 
|:-------|:------------- | :----------|:----------|:---------|:-----|
|   记录ID  |     reserveID    |   varchar(19)   |  是      |   否     | 操作时间15位加当日流水4位组成，如当日流水超过4位，则当日不可预订 |
|   借书卡号  |     userBorrowID    |   varchar(13)   |  否      |   否     |  外键约束：借书者-借书卡号  |
|   图书编号  |     bookNo    |   varchar(14)   |  否      |   否     | 外键约束：图书书目-图书编号；预订图书，借书者只需提供图书名称即可，图书名称存储在馆藏资源类中 |
|   预订日期  |     reserveDate    |   date   |  否      |   否     | 当前预订操作的日期，如超过3天没有完成借书操作，则预订失效 |
|   状态  |     reserveStatus    |   bit   |  否      |   否     | 0：失效；1：有效 |

##### 数据表5：借书记录-borrowBook
|    项目   |       字段名       |      类型与宽度     |   是否主键    |   是否允许空值  |  说明 | 
|:-------|:------------- | :----------|:----------|:---------|:-----|
|   记录ID  |     borrowID    |   varchar(19)   |  是      |   否     | 操作时间15位加当日流水4位组成，如当日流水超过4位，则当日不可借书 |
|   借书卡号  |     userBorrowID    |   varchar(13)   |  否      |   否     |  外键约束：借书者-借书卡号  |
|   图书编号  |     bookNo    |   varchar(14)   |  否      |   否     | 外键约束：图书书目-图书编号；借书需要指定到具体的每本书，注意区分预订的区别 |
|   借书日期  |     borrowDate    |   date   |  否      |   否     | 当前借书操作的日期 |
|   应还日期  |     shouldReturnDate    |   date   |  否      |   否     | 应还日期为借书日期后1月 |
|   实还日期  |     returnDate    |   date   |  否      |   是    | 同一用户同一本书续借超过4个月，则有1个月冷却时间，冷却过后才能再次借该书 |
|   续借次数  |     reserveDate    |   date   |  否      |   否     | 根据借书者芝麻分，每次续借时间1个月，最大续借次数为4次。 |

##### 数据表6：逾期记录-overdue
|    项目   |       字段名       |      类型与宽度     |   是否主键    |   是否允许空值  |  说明 | 
|:-------|:------------- | :----------|:----------|:---------|:-----|
|   记录ID  |     borrowID    |   varchar(19)   |  是      |   否     | 外键约束：借书记录-记录ID |
|   逾期天数  |     overdueDays    |   int   |  否      |   否     |    |
|   罚款金额  |     fineNumber    |   int   |  否      |   否     |  根据逾期天数计算罚款金额，计算方式待定  |
|   状态  |     overdueStatus    |   bit   |  否      |   否     |  1：罚款已交；0：罚款未交  |

##### 数据表7：借书者-users
|    项目   |       字段名       |      类型与宽度     |   是否主键    |   是否允许空值  |  说明 | 
|:-------|:------------- | :----------|:----------|:---------|:-----|
|   借书者ID  |     userID    |   varchar(11)   |  是      |   否     | 自动增长 |
|   姓名  |     userName    |   varchar(30)   |  否      |   否     |    |
|   性别  |     userSex    |   varchar(2)   |  否      |   否     |    |
|   借书卡号  |     userBorrowID    |   varchar(13)   |  否      |   否     |  如同学工号  |
|   身份证号  |     userIDcard    |   varchar(18)  |  否      |   否     |  注册用户必须实名认证，此项目加密保存  |
|   图书限额  |     userQuota    |   short   |  否      |   否     |  默认值为5，最大值不可超过10  |
|   已借图书书目  |     userHaveBorrowedBookNum    |   short   |  否      |   否     |   默认为0 |
|   芝麻信用分  |     zhimaCreditScore    |   int   |  否      |   否     |  当创建用户的时候从接口读取用户芝麻分，如读取失败，则创建用户失败。如用户不是芝麻分用户，则为0，借书限额会变低  |

##### 数据表8：图书管理员-librarians
|    项目   |       字段名       |      类型与宽度     |   是否主键    |   是否允许空值  |  说明 | 
|:-------|:------------- | :----------|:----------|:---------|:-----|
|   管理员ID  |     librarianID    |   varchar(11)   |  是      |   否     | 加密保存，系统管理员为每个图书管理员分配唯一的包含字母和数字的管理员ID，管理员通过ID和姓名登录 |
|   姓名  |     librarianName    |   varchar(20)   |  否      |   否     |  加密保存，为了安全，名字可不必为真实名字  |

##### 数据表9：系统管理员-administrator
|    项目   |       字段名       |      类型与宽度     |   是否主键    |   是否允许空值  |  说明 | 
|:-------|:------------- | :----------|:----------|:---------|:-----|
|   管理员ID  |     administratorID    |   varchar(11)   |  是      |   否     | 加密保存，系统管理员自己设定管理员ID，管理员通过ID和姓名登录，如忘记ID，可通过登录数据库修改 |
|   姓名  |     administratorName    |   varchar(20)   |  否      |   否     |  加密保存，为了安全，名字可不必为真实名字   |

## 二、界面设计-借书界面设计
![](./borrow.png '借书界面')
* 说明：图书管理员可进行借书，还书，处理预订信息的操作，首先图书管理员可进行条件查找图书，并显示图书信息在下方。借书操作时：
  1. 图书管理员先刷借书卡，读取借书者信息在显示框中
  2. 再刷图书条形码，显示图书ISBN，点击查找可显示图书信息
  3. 选中图书复选框，点击下方提交按钮，即可完成借书操作
## 三、接口设计
### 3.1 查找图书接口
 1. **功能：** 按条件查找图书，按ISBN查找图书
 2. **请求地址：** http://sunBookManager/v1/api/GET/books
 3. **请求方式：** GET 
 4. **请求参数说明：** 

| 参数名称       | 必填  | 说明 |
|:--------------|:-----|:-------|
| access_token | 是    | 用于验证请求合法性的认证信息 |
|method       |是     |固定为GET|
|version      |是     |客户端版本号|
|resource_name| 否|图书名称|
|author|否|作者|      
|publish_house|否|出版社|
|publish_year|否|年份|
|type|否|图书类型|
|ISBN|否|图书ISBN编号|
 5. **返回实例：**
```
{
    "info": "查找成功",
    "data": {
        "resource_name": "孙守利量子力学",
        "author": "郭守义",
        "publish_house": "地球科学出版社",
        "publish_date": "2018年5月",
        "type": "科学-物理学",
        "resource_introduction": "详细讲解了量子力学原理",
        "resource_have_number": "0",
        "status": "借空"
    },
    "code": 200
}
```
 6. **返回参数说明：**
 
|参数名称|说明|
|:-----|:-----|
|"info"|返回的提示信息|
|"data"|返回的图书信息|
|"code"|返回码|


### 3.2 查找借书记录接口
 1. **功能：** 按借书卡号查找用户的部分信息和全部记录
 2. **请求地址：** http://sunBookManager/v1/api/GET/borrow_book_record
 3. **请求方式：** GET 
 4. **请求参数说明：** 

| 参数名称       | 必填  | 说明 |
|:--------------|:-----|:-------|
| access_token | 是    | 用于验证请求合法性的认证信息 |
|method       |是     |固定为GET|
|version      |是     |客户端版本号|
|user_borrow_id| 是|借书卡号|

 5. **返回实例：**
```
{
    "info": "查找成功",
    "data": { 
        "user_name": "孙小利",
        "user_have_borrowed_book_num": "2",
        "zhima_credit_score": "802",
        "could_borrow": "是",
        "link":{
            "rel":"collection http://sunBookManager/v1/api/records",
            "href":"http://sunBookManager/v1/api/records",
        }
    },
    "code": 200
}
```
 6. **返回参数说明：**
 
|参数名称|说明|
|:-----|:-----|
|"info"|返回的提示信息|
|"data"|返回的用户的部分信息|
|"data"-"link"|返回用户的借书记录api链接|
|"code"|返回码|

### 3.3 借书操作接口
 1. **功能：** 按借书卡号和图书ISBN编码执行借书
 2. **请求地址：** http://sunBookManager/v1/api/POST/borrow_book
 3. **请求方式：** POST 
 4. **请求参数说明：** 

| 参数名称       | 必填  | 说明 |
|:--------------|:-----|:-------|
| access_token | 是    | 用于验证请求合法性的认证信息 |
|method       |是     |固定为GET|
|version      |是     |客户端版本号|
|user_borrow_id| 是|借书卡号|
|book_isbn_no|是|图书ISBN编码|

 5. **返回实例：**
```
{
    "info": "借书操作成功",
    "code": 200
}
```
 6. **返回参数说明：**
 
|参数名称|说明|
|:-----|:-----|
|"info"|返回的提示信息|
|"code"|返回码|
